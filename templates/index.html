<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Check-Mate</title>
    <link rel="stylesheet" href="/static/style.css">
    <script>
        async function submitQuery() {
            const question = document.getElementById("question").value;
            const document = document.getElementById("document").value;
            const refine_query = document.getElementById("refine_query").value;
            const include_subsections = document.getElementById("include_subsections").checked;

            const response = await fetch("/search", {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({question, document, refine_query, include_subsections}),
            });

            const results = await response.json();
            const resultsDiv = document.getElementById("results");
            resultsDiv.innerHTML = "<h2>Check-Mateâ€™s Response</h2><p>Use the document filter to view all matches.</p>";

            results.forEach(r => {
                const div = document.createElement("div");
                div.className = "result";
                div.innerHTML = `<strong>Section ${r.section}</strong><br>${r.text}`;
                resultsDiv.appendChild(div);
            });
        }

        function autoSubmit() {
            clearTimeout(window.submitTimeout);
            window.submitTimeout = setTimeout(submitQuery, 400);
        }
    </script>
</head>
<body>
    <div id="sidebar">
        <label>Filter by Document:</label>
        <select id="document" onchange="submitQuery()">
            <option value="">All Documents</option>
            {% for doc in documents %}
            <option value="{{ doc }}">{{ doc }}</option>
            {% endfor %}
        </select>
        <label>Refine Search:</label>
        <input type="text" id="refine_query" oninput="autoSubmit()">
        <label><input type="checkbox" id="include_subsections" onchange="submitQuery()"> Include Subsections</label>
    </div>

    <div id="main">
        <h1>Check-Mate</h1>
        <textarea id="question" rows="2" placeholder="Ask your question..." oninput="autoSubmit()"></textarea>
        <div id="results"></div>
    </div>
</body>
</html>
